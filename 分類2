請設計一個「離線、單一 HTML、可用 file:// 直接開啟」的分類帳分析系統。
這不是 ERP、不是報表工具，而是一個將報表型分類帳還原為可推理交易資料，並以固定、可回放規則展開帳務判斷的分析系統。
一、系統目標與核心原則
系統唯一資料來源為解析後的交易陣列 tx[]
所有分析模組僅可讀取 tx[]，不得回頭操作原始 Excel
所有邏輯必須為純規則、可重算、可驗證
系統不做判斷，只攤開帳務邏輯供人確認
二、資料解析規格（Excel → tx[]）
JS 解析 Excel 時，需：
完全丟棄：公司名、頁次、抬頭、裝飾列
排除：月計、累計、上期結轉（不進交易層）
每一筆「真正交易」需轉為一列標準結構：
account_code（科目代碼）
account_name（科目名稱）
account_nature（借 / 貸性質）
date
voucher_no（傳票號碼）
summary_raw（原始摘要，完整保留）
summary_base（去除年月與期別後的核心摘要）
period_key（YYYY-MM）
debit_amount
credit_amount
所有金額進入邏輯前一律轉為「整數分」。
三、摘要雙層結構
summary_raw：完整保存，用於回溯
summary_base：僅移除年月、期別，其餘文字完全保留
例：
-「114年1月郵電費」
-「114年2月郵電費」
→ summary_base = 郵電費
四、畫面結構（固定）
僅三個區塊：
上：檔案選擇與解析狀態
中：功能模組切換
下：條件設定區 + 結果區
所有模組共用同一份資料，禁止複製或同步狀態。
五、功能模組規格
1️⃣ 摘要檢視與合計
一筆交易只能屬於一個摘要群
群鍵值 = account_code + summary_base
是否合併期間由使用者控制
合併時需自動壓縮期間顯示（連續顯示區間，非連續顯示集合）
群內顯示實際出現過的 summary_raw 清單
群加總必須等於群內交易加總
群可「鎖定」，鎖定後重新解析不得被自動邏輯修改
2️⃣ 應收付沖帳
自動沖銷
僅在單一科目內運作
僅在同一摘要群內
僅做「金額相等、方向相反」的一對一配對
成立即標記，否則進未沖銷池
手動沖銷
借方總和必須等於貸方總和
不限筆數，但永遠平衡
成立才寫入沖銷結果
沖後剩餘交易以摘要群方式輸出，顯示卡點。
3️⃣ 數字池（嵌於沖帳）
預設候選僅來自該科目之自然側
可切換側別，但永遠單側運算，禁止混用
回傳結果為「可驗算的傳票集合」
可直接送入手動沖銷
4️⃣ 關鍵字搜尋
僅全文命中，不做推理
命中文字高亮
結果按科目收納
任一交易可直接送入摘要或沖銷流程
5️⃣ 獨立數字池分析
選科目、選側別、輸入目標金額
僅在該集合內做數學組合
不讀、不寫任何沖銷狀態
6️⃣ 異常交易偵測
重複系列
同科目、同摘要、同金額，出現 ≥2 次即列出全系列
偏離行為
對同摘要群計算中位數與 MAD
超過門檻標示為拉高 / 拉低
僅回傳傳票，不加評語
7️⃣ 跨科目摘要鏈結
以 summary_base 為鍵
掃描所有科目
顯示各科目借貸流向與最終淨額
錯科目、漏轉、分流需直接可視
8️⃣ 金額結構完整性檢查
不看摘要文字，只看金額形狀：
是否長期固定倍數或固定尾數
是否特定期間位數突變
是否單側累積、不再回沖
9️⃣ 時間斷層偵測
使用者指定摘要
建立正常時間節奏
偵測缺月、跳月、零額月
可選擇是否檢查「理應存在但缺失的金額」
僅回傳缺口點與對應傳票範圍
🔟 規則學習（人工確認制）
記錄所有手動摘要調整與沖銷
下次匯入僅做「推測預分」
必須由人確認或否決
系統不得自動下判斷
1️⃣1️⃣ 帳務閉合檢查
不看單筆，看摘要群整體狀態
檢查：
該歸零是否歸零
該留餘是否被異常沖掉
該累積是否被拆散到多科目
用於找「故事沒講完的帳」
六、系統架構約束
一個解析器（Excel → tx[]）
一組純函式（摘要、期間、沖銷、數字池、異常）
無副本、無同步狀態、無隱性邏輯
七、系統定位聲明
這不是報表工具。
這是一個把分類帳轉為可反覆驗證、可質疑、可回放的帳務分析系統。
所有過去靠經驗抓的判斷，都必須被固定為可重現規則。
請依上述規格設計系統，不得自行擴充職能或引入黑箱邏輯