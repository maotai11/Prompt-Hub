<!DOCTYPE html><html lang="zh-Hant-TW">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ArtSyn Hybrid â€” å–®æª”é›¢ç·š A4 æ¨™ç±¤ç”¢ç”Ÿå™¨</title>
<meta name="description" content="å®Œå…¨é›¢ç·šã€å–®ä¸€ HTML æª”å³å¯ä½¿ç”¨ï¼šå®¢æˆ¶è³‡æ–™åº«ã€æ’åºã€é è¦½ã€åˆ—å°ï¼ˆA4ï¼‰ã€JSON åŒ¯å‡º/åŒ¯å…¥ã€ç‰ˆæœ¬ã€å›æ”¶æ¡¶ã€ï¼ˆIDB æ¨¡å¼å¯é™„ä»¶ï¼‰ã€‚æ–¹å‘ä¸‰ï½œEditorial Vogue Ã— Bazaar Hybridã€‚"/>
<style>
  :root{
    /* ===== Design Tokens ===== */
    --ink-black:#000000; /* Vogue ä¸»å­—è‰² */
    --ivory:#F8F8F6;     /* è±¡ç‰™ç™½èƒŒæ™¯ */
    --rose-gold:#C7A27C; /* Bazaar ç«ç‘°é‡‘ */
    --smoke:#1A1A1A;     /* ç…™é»‘é¢ */
    --mist-silver:#C0C4C9; /* éœ§éŠ€åˆ†éš”/æé‚Š */
    --cream:#FAF7F2;     /* å¥¶æ²¹ç™½éæ¸¡ */
    --soft-gray:#6B7280; /* æ­£æ–‡æ¬¡è¦ */--fs-display: clamp(40px, 6vw, 56px);
--fs-h1: clamp(26px, 3.2vw, 40px);
--fs-h2: clamp(20px, 2.4vw, 28px);
--fs-h3: clamp(18px, 2vw, 22px);
--fs-body: 16px;
--lh-display: 1.1;
--lh-h: 1.25;
--lh-body: 1.75;

--shadow-soft: 0 6px 20px rgba(0,0,0,.07);
--radius-2xl: 16px;

--easing-emphasized: cubic-bezier(0.33,1,0.68,1);
--dur-stagger: 300ms; /* Hero å­—æ¯éšæ¢¯ç¸½ç¯€å¥ */
--dur-breathe-min: 600ms; /* é€²å ´ä¸‹é™ */
--dur-breathe-max: 1000ms;/* é€²å ´ä¸Šé™ */

/* Magazine Grid */
--container-w: min(1200px, 92vw);
--gutter: clamp(24px, 3vw, 32px);

/* Print page */
--a4-w: 210mm;
--a4-h: 297mm;
--print-margin: 12mm;

}

/* ===== Base ===== */ html,body{height:100%;} body{ margin:0; background:var(--ivory); color:var(--smoke); font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Arial, "PingFang TC", "Microsoft JhengHei", sans-serif; font-size:var(--fs-body); line-height:var(--lh-body); } a{color:inherit; text-decoration:none} *{box-sizing:border-box} .container{width:var(--container-w); margin:0 auto; padding:0 var(--gutter);}

/* ===== Header ===== */ header{ position:fixed; inset:0 0 auto 0; height:64px; display:flex; align-items:center; z-index:50; background:linear-gradient(to bottom, rgba(26,26,26,.8), rgba(26,26,26,0)); color:white; transition:all .4s var(--easing-emphasized); border-bottom:1px solid transparent; } header.scrolled{ background:linear-gradient(to bottom, rgba(26,26,26,.9), rgba(26,26,26,.6)); border-bottom-color:rgba(192,196,201,.35);} header .wrap{display:flex; align-items:center; gap:16px; width:var(--container-w); margin:0 auto; padding:0 var(--gutter);} .brand{font-size:18px; letter-spacing:.08em; font-weight:700} .brand b{color:var(--rose-gold)} nav{margin-left:auto; display:flex; gap:12px} .btn{appearance:none; border:1px solid var(--mist-silver); background:linear-gradient(to bottom right, #fff, #f8f8f8); color:var(--smoke); padding:8px 12px; border-radius:12px; box-shadow:var(--shadow-soft); cursor:pointer; transition:transform .2s ease, color .2s ease, border-color .2s ease;} .btn:hover{ transform:scale(1.02); color:var(--ink-black); border-color:#A8ADB3 } .btn.ghost{ background:transparent; color:white; border-color: rgba(255,255,255,.4)} .btn.ghost:hover{ color:#fff; border-color:#fff }

/* ===== Hero ===== */ .block-hero{ padding-top:96px; padding-bottom:64px; position:relative; overflow:hidden;} .hero-bg{ position:absolute; inset:0; background: conic-gradient(from 180deg at 50% 50%, rgba(199,162,124,.18), rgba(255,255,255,0) 25%, rgba(199,162,124,.18) 50%, rgba(255,255,255,0) 75%, rgba(199,162,124,.18)); animation: sweep 14s linear infinite; opacity:.6; filter:blur(40px);} @keyframes sweep{ 0%{transform:translateX(-10%)} 50%{transform:translateX(10%)} 100%{transform:translateX(-10%)} } .hero-inner{ position:relative; } .hero-title{ font-size:var(--fs-display); line-height:var(--lh-display); letter-spacing:.02em; color:var(--ink-black); font-weight:800;} .hero-title .char{ display:inline-block; opacity:0; transform:translateY(18px); } .hero-sub{ font-size:var(--fs-h3); color:var(--soft-gray); margin-top:8px; opacity:0; transform:translateY(10px); transition:all .8s var(--easing-emphasized) .2s;} .hero-ready .hero-sub{ opacity:1; transform:none }

/* ===== Editorial Blocks (ç¤ºæ„) ===== */ .blocks{ display:grid; grid-template-columns: 1fr; gap: clamp(40px, 6vw, 72px); padding: 24px 0 56px; } .block{ background:linear-gradient(to bottom, #fff, var(--cream)); border:1px solid var(--mist-silver); border-radius:var(--radius-2xl); box-shadow:var(--shadow-soft); padding: clamp(20px, 3vw, 28px); } .block h2{ font-size:var(--fs-h2); line-height:var(--lh-h); margin:0 0 12px } .muted{ color:var(--soft-gray) }

/* ===== App Shell ===== */ .app{ display:grid; grid-template-columns: 320px 1fr; gap: var(--gutter); align-items:start; } .panel{ background:#fff; border:1px solid var(--mist-silver); border-radius:var(--radius-2xl); box-shadow:var(--shadow-soft); overflow:hidden; } .panel .head{ display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid var(--mist-silver); background:linear-gradient(to bottom,#fff,#f9f9f9);} .panel .head h3{ font-size:var(--fs-h3); margin:0 } .panel .body{ padding:12px 16px; }

.list{ display:flex; flex-direction:column; gap:8px; } .list .item{ display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border:1px solid #E5E7EB; border-radius:12px; background:#fff;} .list .item:hover{ transform:translateY(-1px); border-color:#D4D8DE }

.toolbar{ display:flex; gap:8px; flex-wrap:wrap } .row{ display:grid; grid-template-columns: 1fr 1fr; gap:8px; margin-bottom:8px } .row3{ display:grid; grid-template-columns: 1fr 1fr 1fr; gap:8px; margin-bottom:8px } .input, select{ width:100%; padding:10px 12px; border:1px solid #D5D8DE; border-radius:10px; background:#fff; font:inherit } .input:focus, select:focus, .btn:focus{ outline:2px solid var(--mist-silver); box-shadow:0 0 0 1px var(--rose-gold) inset }

.caps{ text-transform:uppercase; letter-spacing:.08em; font-size:12px; color:var(--soft-gray) }

/* ===== Preview Area ===== */ .preview-tabs{ display:flex; gap:8px; margin-bottom:12px } .tab{ padding:8px 10px; border-radius:10px; border:1px solid var(--mist-silver); background:#fff; cursor:pointer } .tab.active{ background:var(--ink-black); color:#fff; border-color:var(--ink-black) }

.preview{ background:#fff; border:1px solid var(--mist-silver); border-radius:var(--radius-2xl); box-shadow:var(--shadow-soft); padding:12px; } .preview .a4{ width: calc(var(--a4-w) - 2var(--print-margin)); min-height: calc(var(--a4-h) - 2var(--print-margin)); margin:0 auto; background:#fff; border:1px dashed #E5E7EB; padding:10mm; } .frames{ display:grid; grid-template-columns: repeat(auto-fill, minmax(58mm, 1fr)); gap:6mm; align-content:start; } .frame{ aspect-ratio: 15 / 6; border:1px solid #CFCFCF; border-radius:12px; display:flex; align-items:center; justify-content:center; position:relative; padding:6mm; } .frame b{ font-size:14pt; color:var(--ink-black) } .frame small{ position:absolute; bottom:6px; right:10px; color:#999 }

/* ===== Modals ===== */ dialog{ border:none; border-radius:16px; box-shadow:0 18px 60px rgba(0,0,0,.18); width:min(720px, 92vw); } dialog::backdrop{ background:rgba(0,0,0,.35) } .modal-head{ padding:14px 16px; border-bottom:1px solid var(--mist-silver); background:linear-gradient(to bottom,#fff,#f7f7f7); display:flex; justify-content:space-between; align-items:center } .modal-body{ padding:12px 16px; max-height:65vh; overflow:auto }

/* ===== Reveal on scroll ===== */ .reveal{ opacity:1; transform:none } .js .reveal{ opacity:0; transform:translateY(20px); transition: all .8s var(--easing-emphasized); } .revealed{ opacity:1; transform:none }

/* ===== Utilities ===== */ .spacer{ height:1px; background:linear-gradient(to right, transparent, var(--mist-silver), transparent); margin:20px 0 } .right{ text-align:right }

/* ===== Print Styles ===== */ @media print{ @page{ size: A4; margin: var(--print-margin); } header, .block-hero, .blocks .block:not(.printable), .controls, .preview-tabs{ display:none !important } body{ background:white } .preview{ border:none; box-shadow:none } .preview .a4{ border:none; padding:0; width:auto; min-height:auto } .frames{ gap:5mm } .frame{ break-inside:avoid; page-break-inside:avoid; border-color:#000 } } </style>

</head>
<body>
  <!-- ===== Header ===== -->
  <header id="hdr">
    <div class="wrap">
      <div class="brand" aria-label="å“ç‰Œ">ğŸ–¼ï¸ ArtSyn <b>Hybrid</b></div>
      <nav>
        <button class="btn ghost" id="btnImport" title="åŒ¯å…¥ JSON">åŒ¯å…¥</button>
        <button class="btn ghost" id="btnExport" title="åŒ¯å‡º JSON">åŒ¯å‡º</button>
        <button class="btn ghost" id="btnDoc" title="åŒ¯å‡º Word(HTML)">åŒ¯å‡ºWord</button>
        <button class="btn ghost" id="btnPrint" title="åˆ—å°">åˆ—å°</button>
      </nav>
    </div>
  </header>  <!-- ===== Hero ===== -->  <section class="block-hero">
    <div class="hero-bg" aria-hidden="true"></div>
    <div class="container hero-inner">
      <h1 class="hero-title" id="heroTitle">Editorial Vogue Ã— Bazaar Hybrid â€” A4 æ¨™ç±¤/åæ¢</h1>
      <p class="hero-sub">å†·éœå¥¢è¯çš„é›œèªŒå¼ç¶²æ ¼ï¼Œå®Œå…¨é›¢ç·šï¼Œä¸€æª”åœ¨æ‰‹å³å¯ CRUDï¼æ’åºï¼é è¦½åˆ—å°ã€‚</p>
    </div>
  </section>  <!-- ===== Main Blocks ===== -->  <main class="container blocks"><!-- èªªæ˜ / æ§åˆ¶ -->
<section class="block reveal printable">
  <h2>ã€ˆé è¦½èˆ‡è¼¸å‡ºæ§åˆ¶ã€‰</h2>
  <div class="app">
    <!-- å·¦ï¼šå®¢æˆ¶æ¸…å–®èˆ‡è³‡æ–™åº« -->
    <aside class="panel" aria-label="å®¢æˆ¶è³‡æ–™åº«">
      <div class="head">
        <h3>å®¢æˆ¶è³‡æ–™åº«</h3>
        <div class="toolbar">
          <button class="btn" id="btnAdd">æ–°å¢</button>
          <button class="btn" id="btnSortAZ">Aâ†’Z</button>
          <button class="btn" id="btnSortZA">Zâ†’A</button>
          <button class="btn" id="btnTrash">å›æ”¶æ¡¶</button>
        </div>
      </div>
      <div class="body">
        <div class="row">
          <input id="q" class="input" placeholder="æœå°‹å®¢æˆ¶â€¦ (åç¨±/æ¨™ç±¤)"/>
          <input id="tag" class="input" placeholder="æ–°å¢æ™‚é è¨­æ¨™ç±¤ (å¯ç©º)"/>
        </div>
        <div class="list" id="list" aria-live="polite"></div>
      </div>
    </aside>

    <!-- å³ï¼šé è¦½èˆ‡æ’åº -->
    <section class="panel" aria-label="é è¦½èˆ‡æ’åº">
      <div class="head">
        <h3>é è¦½å€</h3>
        <div class="toolbar controls">
          <button class="btn" id="btnPickAll">é¸å–å…¨éƒ¨</button>
          <button class="btn" id="btnConfirm">ç¢ºèªé¸å–</button>
        </div>
      </div>
      <div class="body">
        <div class="row3">
          <label><span class="caps">å¹´ï¼ˆYYYï¼‰</span><input id="yearYYY" class="input" inputmode="numeric" placeholder="ä¾‹ï¼š114" value="114"></label>
          <label><span class="caps">èµ·å§‹æœˆ</span><input id="mStart" class="input" inputmode="numeric" placeholder="ä¾‹ï¼š09" value="09"></label>
          <label><span class="caps">çµæŸæœˆ</span><input id="mEnd" class="input" inputmode="numeric" placeholder="ä¾‹ï¼š10" value="10"></label>
        </div>
        <div class="row3">
          <label><span class="caps">æœŸæ•¸ï¼ˆä»½æ•¸ï¼‰</span><input id="count" class="input" type="number" min="1" value="6"></label>
          <label><span class="caps">æ¯ä½å®¢æˆ¶å¼µæ•¸</span><input id="perClient" class="input" type="number" min="1" value="2"></label>
          <label><span class="caps">æ’åº</span>
            <select id="order">
              <option value="asc">Aâ†’Z</option>
              <option value="desc">Zâ†’A</option>
              <option value="custom">è‡ªè¨‚åº</option>
            </select>
          </label>
        </div>

        <div class="preview-tabs">
          <button class="tab active" data-tab="p1">é è¦½1ï½œA4 æ¨™ç±¤æ’ç‰ˆ</button>
          <button class="tab" data-tab="p2">é è¦½2ï½œæ’åºæ¸…å–®</button>
        </div>

        <div class="preview" id="preview">
          <div class="tab-panel" id="p1" role="tabpanel">
            <div class="a4">
              <div class="frames" id="frames"></div>
            </div>
          </div>
          <div class="tab-panel" id="p2" role="tabpanel" hidden>
            <ol id="ordered" style="padding:18px 24px;">
              <!-- 1. å®¢æˆ¶A 2. å®¢æˆ¶B ... -->
            </ol>
            <p class="muted" style="padding:0 24px 12px">æ‹–æ›³æˆ–ä½¿ç”¨æ¯åˆ—çš„â–²â–¼å¾®èª¿éµä»¥èª¿æ•´è‡ªè¨‚åºã€‚</p>
          </div>
        </div>

      </div>
    </section>
  </div>
</section>

<!-- èªªæ˜ -->
<section class="block reveal">
  <h2>ã€ˆåˆ—å°èˆ‡ Word åŒ¯å‡ºèªªæ˜ã€‰</h2>
  <ul>
    <li>åˆ—å°ï¼šæŒ‰å³ä¸Šè§’ã€Œåˆ—å°ã€æˆ– <kbd>Ctrl/Cmd + P</kbd>ã€‚ç³»çµ±å°‡ä»¥ A4 ç´™å¼µè‡ªå‹•åˆ†é ï¼Œæ¡†æ¯”ä¾‹å›ºå®š <b>15:6</b>ï¼Œè·¨é è‡ªå‹•å»¶çºŒã€‚</li>
    <li>Word åŒ¯å‡ºï¼šç”¢ç”Ÿ .doc ç›¸å®¹ä¹‹ HTMLï¼ˆç„¡å¤–æ›ï¼‰ï¼Œæ–¼ Word é–‹å•Ÿå¾Œä¾ A4 å°ºå¯¸åˆ†é ã€‚</li>
    <li>å®Œå…¨é›¢ç·šï¼šè³‡æ–™å„²å­˜æ–¼ <b>IndexedDB</b>ï¼ˆè‹¥ç€è¦½å™¨ä¸æ”¯æ´ï¼Œé™ç´šè‡³ localStorageï¼Œé™„ä»¶åœç”¨ï¼‰ã€‚</li>
  </ul>
</section>

  </main>  <!-- ===== Dialogs ===== -->  <dialog id="dlgPick">
    <div class="modal-head"><strong>ç¢ºèªé¸å–å®¢æˆ¶</strong><button class="btn" onclick="dlgPick.close()">é—œé–‰</button></div>
    <div class="modal-body">
      <label style="display:flex;align-items:center;gap:8px;margin-bottom:8px"><input type="checkbox" id="pickAll"> å…¨é¸/å…¨ä¸é¸</label>
      <div id="pickList" class="list"></div>
      <div class="right" style="margin-top:12px"><button class="btn" id="btnApplyPick">å¥—ç”¨</button></div>
    </div>
  </dialog>  <dialog id="dlgTrash">
    <div class="modal-head"><strong>å›æ”¶æ¡¶</strong><button class="btn" onclick="dlgTrash.close()">é—œé–‰</button></div>
    <div class="modal-body">
      <div id="trashList" class="list"></div>
    </div>
  </dialog><script>
// å•Ÿç”¨ JS æ¨™è¨˜ï¼Œè‹¥ JS ç„¡æ³•åŸ·è¡Œå‰‡ä¿ç•™æ‰€æœ‰å…§å®¹å¯è¦‹ï¼ˆé¿å…æ•´é ç©ºç™½ï¼‰
try{ document.documentElement.classList.add('js'); }catch(e){}
/* =========================================================
   Data Layerï¼šIndexedDB å„ªå…ˆï¼ŒlocalStorage å›é€€
   models: customers, versions, trash
   ========================================================= */
const DB_NAME = 'artsyn-hybrid-db';
const DB_VER = 1;
let useLS = false; // fallback flag
let db = null;

function openDB(){
  return new Promise((resolve)=>{
    if(!('indexedDB' in window)){
      useLS = true; resolve(); return;
    }
    const req = indexedDB.open(DB_NAME, DB_VER);
    req.onupgradeneeded = (e)=>{
      const d = e.target.result;
      if(!d.objectStoreNames.contains('customers')){
        d.createObjectStore('customers', {keyPath:'id'});
      }
      if(!d.objectStoreNames.contains('versions')){
        d.createObjectStore('versions', {keyPath:'versionId'});
      }
      if(!d.objectStoreNames.contains('trash')){
        d.createObjectStore('trash', {keyPath:'id'});
      }
    };
    req.onsuccess = ()=>{ db = req.result; resolve(); };
    req.onerror = ()=>{ useLS = true; resolve(); };
  });
}

const LS_KEYS = { customers:'hyb_customers', versions:'hyb_versions', trash:'hyb_trash' };

async function dbGetAll(store){
  if(useLS){ return JSON.parse(localStorage.getItem(LS_KEYS[store])||'[]'); }
  return new Promise((resolve,reject)=>{
    const tx = db.transaction(store,'readonly');
    const os = tx.objectStore(store);
    const req = os.getAll();
    req.onsuccess = ()=>resolve(req.result||[]);
    req.onerror = reject;
  });
}
async function dbPut(store, value){
  if(useLS){
    const arr = JSON.parse(localStorage.getItem(LS_KEYS[store])||'[]');
    const idx = arr.findIndex(x=>x[(store==='versions'?'versionId':'id')]===value[(store==='versions'?'versionId':'id')]);
    if(idx>-1) arr[idx]=value; else arr.push(value);
    localStorage.setItem(LS_KEYS[store], JSON.stringify(arr));
    return;
  }
  return new Promise((resolve,reject)=>{
    const tx = db.transaction(store,'readwrite');
    tx.objectStore(store).put(value);
    tx.oncomplete=resolve; tx.onerror=reject;
  });
}
async function dbBulkPut(store, values){ for(const v of values) await dbPut(store,v); }
async function dbDelete(store, key){
  if(useLS){
    const arr = JSON.parse(localStorage.getItem(LS_KEYS[store])||'[]').filter(x=>x[(store==='versions'?'versionId':'id')]!==key);
    localStorage.setItem(LS_KEYS[store], JSON.stringify(arr)); return;
  }
  return new Promise((resolve,reject)=>{
    const tx = db.transaction(store,'readwrite');
    tx.objectStore(store).delete(key);
    tx.oncomplete=resolve; tx.onerror=reject;
  });
}

function uuid(){ return Math.random().toString(36).slice(2) + Date.now().toString(36) }

/* =========================================================
   State & Rendering
   ========================================================= */
const state = {
  customers: [], // {id,name,tags:string[]}
  trash: [],
  versions: [],
  filter:'',
  preselect: new Set(),
  customOrder: [],
};

function snapshot(reason){
  const v = { versionId: uuid(), createdAtTS: Date.now(), reason, customers: state.customers };
  state.versions.unshift(v);
  dbPut('versions', v);
  // ä¿ç•™æœ€å¤š50ç‰ˆ
  if(state.versions.length>50){ const last = state.versions.pop(); dbDelete('versions', last.versionId); }
}

function renderList(){
  const list = document.getElementById('list');
  list.innerHTML='';
  const q = state.filter.toLowerCase();
  const data = state.customers.filter(c=>!q||c.name.toLowerCase().includes(q)|| (c.tags||[]).some(t=>t.toLowerCase().includes(q)));
  if(data.length===0){ list.innerHTML = `<div class="muted">å°šç„¡è³‡æ–™ã€‚æŒ‰ã€Œæ–°å¢ã€å»ºç«‹å®¢æˆ¶ã€‚</div>`; return; }
  data.sort((a,b)=> a.name.localeCompare(b.name,'zh-Hant'));
  for(const c of data){
    const row = document.createElement('div');
    row.className='item';
    row.innerHTML = `<div style="display:flex;align-items:center;gap:8px"><input type="checkbox" ${state.preselect.has(c.id)?'checked':''} data-id="${c.id}" aria-label="é¸å–"> <strong>${c.name}</strong> <span class="muted">${(c.tags||[]).join(', ')}</span></div>
    <div style="display:flex;gap:6px">
      <button class="btn" data-act="edit">ç·¨è¼¯</button>
      <button class="btn" data-act="del">åˆªé™¤</button>
      <button class="btn" data-act="up">â–²</button>
      <button class="btn" data-act="down">â–¼</button>
    </div>`;
    row.querySelector('input[type="checkbox"]').addEventListener('change', (e)=>{
      if(e.target.checked) state.preselect.add(c.id); else state.preselect.delete(c.id);
      buildPreviews();
    });
    row.querySelector('[data-act="edit"]').onclick = ()=>{
      const name = prompt('å®¢æˆ¶åç¨±', c.name); if(!name) return;
      const tag = prompt('æ¨™ç±¤(ä»¥é€—è™Ÿåˆ†éš”)', (c.tags||[]).join(','))||'';
      c.name = name.trim(); c.tags = tag.split(',').map(s=>s.trim()).filter(Boolean);
      snapshot('edit customer'); dbPut('customers', c).then(renderList).then(buildPreviews);
    };
    row.querySelector('[data-act="del"]').onclick = ()=>{
      if(!confirm('ç§»è‡³å›æ”¶æ¡¶ï¼Ÿ')) return;
      state.trash.unshift(c); dbPut('trash', c); state.customers = state.customers.filter(x=>x.id!==c.id); dbDelete('customers', c.id);
      state.preselect.delete(c.id);
      snapshot('delete customer'); renderList(); buildPreviews();
    };
    row.querySelector('[data-act="up"]').onclick = ()=> moveCustom(c.id, -1);
    row.querySelector('[data-act="down"]').onclick = ()=> moveCustom(c.id, +1);
    list.appendChild(row);
  }
}

function moveCustom(id, delta){
  const order = state.customOrder.length? state.customOrder : state.customOrder = state.customers.map(c=>c.id);
  const i = order.indexOf(id); if(i<0) return;
  const j = Math.max(0, Math.min(order.length-1, i+delta));
  [order[i], order[j]] = [order[j], order[i]];
  buildPreviews(); renderOrderedList();
}

function buildFrames(){
  const frames = document.getElementById('frames');
  frames.innerHTML='';
  const yyy = document.getElementById('yearYYY').value.trim();
  const ms = document.getElementById('mStart').value.trim();
  const me = document.getElementById('mEnd').value.trim();
  const cnt = Math.max(1, parseInt(document.getElementById('count').value||'1'));
  const per = Math.max(1, parseInt(document.getElementById('perClient').value||'1'));
  const selected = getOrderedSelected();
  // ç”¢ç”Ÿï¼ˆæ¯ä½å®¢æˆ¶ * æ¯ä½å¼µæ•¸ï¼‰ï¼Œè‹¥æœŸæ•¸>1ï¼Œä»¥å¾ªç’°æ–¹å¼é‡è¦†
  const labels = [];
  for(const c of selected){ for(let k=0;k<per;k++){ labels.push({customer:c.name}); } }
  // è‹¥éœ€è¦æœŸæ•¸ä»½æ•¸ï¼Œé‡è¤‡è‡³æŒ‡å®šæ•¸é‡
  while(labels.length < cnt){ labels.push(...labels.slice(0, Math.min(cnt-labels.length, labels.length||1))); if(labels.length===0) break; }
  labels.length = Math.min(labels.length, cnt);

  labels.forEach((lb, i)=>{
    const el = document.createElement('div'); el.className='frame';
    el.innerHTML = `<div style="text-align:center">
      <b>${yyy}å¹´${ms}-${me}æœˆã€€${lb.customer}</b>
    </div>
    <small>${i+1}</small>`;
    frames.appendChild(el);
  });
}

function renderOrderedList(){
  const ol = document.getElementById('ordered'); ol.innerHTML='';
  const arr = getOrderedSelected();
  arr.forEach((c, idx)=>{
    const li = document.createElement('li');
    li.style.display='flex'; li.style.alignItems='center'; li.style.justifyContent='space-between'; li.style.padding='8px 10px'; li.style.border='1px solid #E5E7EB'; li.style.borderRadius='10px'; li.style.margin='6px 0';
    li.innerHTML = `<div><strong>${idx+1}. ${c.name}</strong></div>
    <div style="display:flex;gap:6px">
      <button class="btn" aria-label="ä¸Šç§»">â–²</button>
      <button class="btn" aria-label="ä¸‹ç§»">â–¼</button>
    </div>`;
    li.querySelectorAll('button')[0].onclick = ()=>{ moveCustom(c.id,-1); };
    li.querySelectorAll('button')[1].onclick = ()=>{ moveCustom(c.id,+1); };
    ol.appendChild(li);
  });
}

function getOrderedSelected(){
  const orderMode = document.getElementById('order').value;
  let arr = state.customers.filter(c=> state.preselect.has(c.id));
  if(orderMode==='asc') arr.sort((a,b)=>a.name.localeCompare(b.name,'zh-Hant'));
  else if(orderMode==='desc') arr.sort((a,b)=>b.name.localeCompare(a.name,'zh-Hant'));
  else if(orderMode==='custom'){
    const order = state.customOrder.length? state.customOrder : state.customOrder = state.customers.map(c=>c.id);
    arr.sort((a,b)=> order.indexOf(a.id)-order.indexOf(b.id));
  }
  return arr;
}

function buildPreviews(){ buildFrames(); renderOrderedList(); }

/* =========================================================
   Import / Export / Word
   ========================================================= */
function exportJSON(){
  const data = { meta:{app:'ArtSyn Hybrid', ts:Date.now(), version:'1.0'}, customers: state.customers, versions: state.versions, trash: state.trash };
  const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
  const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='artsyn-data.json'; a.click(); }

function importJSON(){
  const inp = document.createElement('input'); inp.type='file'; inp.accept='application/json';
  inp.onchange = async ()=>{
    const file = inp.files[0]; if(!file) return; const text = await file.text();
    try{ const data = JSON.parse(text);
      if(confirm('åŒ¯å…¥å°‡è¦†è“‹ç¾æœ‰è³‡æ–™ã€‚ç¢ºå®šï¼Ÿ')){
        // æ¸…ç©ºç¾æœ‰
        state.customers=[]; state.trash=[]; state.versions=[]; state.preselect.clear(); state.customOrder=[];
        if(!useLS){
          await new Promise((res)=>{ const tx = db.transaction(['customers','versions','trash'],'readwrite'); tx.objectStore('customers').clear(); tx.objectStore('versions').clear(); tx.objectStore('trash').clear(); tx.oncomplete=res; });
        } else {
          localStorage.removeItem(LS_KEYS.customers); localStorage.removeItem(LS_KEYS.versions); localStorage.removeItem(LS_KEYS.trash);
        }
        // å¯«å…¥
        await dbBulkPut('customers', data.customers||[]); await dbBulkPut('versions', data.versions||[]); await dbBulkPut('trash', data.trash||[]);
        state.customers = data.customers||[]; state.versions = data.versions||[]; state.trash = data.trash||[];
        renderList(); buildPreviews();
      }
    }catch(err){ alert('JSON è§£æå¤±æ•—ï¼š'+err.message); }
  };
  inp.click();
}

function exportWord(){
  // å°‡ A4 é é¢ frames ä»¥å…§åµŒæ¨£å¼è¼¸å‡ºç‚º .doc ç›¸å®¹ HTML
  const yyy = document.getElementById('yearYYY').value.trim();
  const ms = document.getElementById('mStart').value.trim();
  const me = document.getElementById('mEnd').value.trim();
  const framesHTML = document.getElementById('frames').innerHTML;
  const styles = `
  @page { size: A4; margin: 12mm; }
  body{font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans', 'Microsoft JhengHei', Arial, sans-serif;}
  .frames{ display:grid; grid-template-columns: repeat(auto-fill, minmax(58mm, 1fr)); gap:6mm; }
  .frame{ aspect-ratio: 15 / 6; border:1px solid #000; border-radius:12px; display:flex; align-items:center; justify-content:center; padding:6mm; position:relative }
  .frame b{ font-size:14pt }
  .frame small{ position:absolute; bottom:6px; right:10px; color:#666 }
  `;
  const html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>${yyy}å¹´${ms}-${me}æœˆ æ¨™ç±¤</title><style>${styles}</style></head><body><div class="frames">${framesHTML}</div></body></html>`;const blob = new Blob([html], {type:'application/msword'}); const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=${yyy}å¹´${ms}-${me}æœˆ-æ¨™ç±¤.doc; a.click(); }

/* ========================================================= UI Events & Init ========================================================= */ function bind(){ document.getElementById('btnAdd').onclick = ()=>{ const name = prompt('å®¢æˆ¶åç¨±'); if(!name) return; const tag = document.getElementById('tag').value.trim(); const item = { id: uuid(), name: name.trim(), tags: tag? tag.split(',').map(s=>s.trim()) : [] }; state.customers.push(item); dbPut('customers', item); state.preselect.add(item.id); snapshot('add customer'); renderList(); buildPreviews(); }; document.getElementById('q').oninput = (e)=>{ state.filter = e.target.value; renderList(); }; document.getElementById('btnSortAZ').onclick = ()=>{ state.customers.sort((a,b)=>a.name.localeCompare(b.name,'zh-Hant')); snapshot('sort A-Z'); renderList(); buildPreviews(); }; document.getElementById('btnSortZA').onclick = ()=>{ state.customers.sort((a,b)=>b.name.localeCompare(a.name,'zh-Hant')); snapshot('sort Z-A'); renderList(); buildPreviews(); }; document.getElementById('btnTrash').onclick = showTrash;

document.getElementById('btnPickAll').onclick = ()=>{ state.preselect = new Set(state.customers.map(c=>c.id)); renderList(); buildPreviews(); }; document.getElementById('btnConfirm').onclick = openPicker;

['yearYYY','mStart','mEnd','count','perClient','order'].forEach(id=>{ document.getElementById(id).addEventListener('input', buildPreviews); document.getElementById(id).addEventListener('change', buildPreviews); });

document.getElementById('btnExport').onclick = exportJSON; document.getElementById('btnImport').onclick = importJSON; document.getElementById('btnDoc').onclick = exportWord; document.getElementById('btnPrint').onclick = ()=>window.print();

// Tabs document.querySelectorAll('.tab').forEach(t=> t.onclick = ()=>{ document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active')); document.querySelectorAll('.tab-panel').forEach(x=>x.hidden=true); t.classList.add('active'); document.getElementById(t.dataset.tab).hidden=false; });

// Header scroll effect const hdr = document.getElementById('hdr'); document.addEventListener('scroll', ()=>{ hdr.classList.toggle('scrolled', window.scrollY>48); }); }

function openPicker(){ const dlg = document.getElementById('dlgPick'); const list = document.getElementById('pickList'); list.innerHTML=''; document.getElementById('pickAll').checked = state.preselect.size === state.customers.length; document.getElementById('pickAll').onchange = (e)=>{ if(e.target.checked) state.preselect = new Set(state.customers.map(c=>c.id)); else state.preselect.clear(); openPicker(); buildPreviews(); }; const data = [...state.customers].sort((a,b)=>a.name.localeCompare(b.name,'zh-Hant')); data.forEach(c=>{ const row = document.createElement('div'); row.className='item'; row.innerHTML = <label style="display:flex;align-items:center;gap:8px"><input type="checkbox" ${state.preselect.has(c.id)?'checked':''}> ${c.name}</label>; row.querySelector('input').onchange = (e)=>{ if(e.target.checked) state.preselect.add(c.id); else state.preselect.delete(c.id); }; list.appendChild(row); }); document.getElementById('btnApplyPick').onclick = ()=>{ dlg.close(); renderList(); buildPreviews(); }; dlg.showModal(); }

function showTrash(){ const dlg = document.getElementById('dlgTrash'); const list = document.getElementById('trashList'); list.innerHTML=''; if(state.trash.length===0){ list.innerHTML='<div class="muted">å›æ”¶æ¡¶æ˜¯ç©ºçš„ã€‚</div>'; } state.trash.forEach(c=>{ const row = document.createElement('div'); row.className='item'; row.innerHTML = <div><strong>${c.name}</strong></div> <div style="display:flex;gap:6px"> <button class="btn" data-act="restore">é‚„åŸ</button> <button class="btn" data-act="purge">æ°¸ä¹…åˆªé™¤</button> </div>; row.querySelector('[data-act="restore"]').onclick = ()=>{ state.customers.push(c); dbPut('customers', c); state.trash = state.trash.filter(x=>x.id!==c.id); dbDelete('trash', c.id); snapshot('restore'); renderList(); buildPreviews(); showTrash(); }; row.querySelector('[data-act="purge"]').onclick = ()=>{ if(!confirm('æ°¸ä¹…åˆªé™¤ä¸å¯å¾©åŸï¼Œç¢ºå®šï¼Ÿ')) return; state.trash = state.trash.filter(x=>x.id!==c.id); dbDelete('trash', c.id); showTrash(); }; list.appendChild(row); }); dlg.showModal(); }

/* Reveal on scroll */ function setupReveal(){ const io = new IntersectionObserver((ents)=>{ for(const e of ents){ if(e.isIntersecting){ e.target.classList.add('revealed'); io.unobserve(e.target); } } }, {threshold:.15}); document.querySelectorAll('.reveal').forEach(el=> io.observe(el)); }

/* Hero stagger letters */ function heroStagger(){ const h = document.getElementById('heroTitle'); const txt = h.textContent; h.textContent=''; txt.split('').forEach((ch,i)=>{ const span = document.createElement('span'); span.className='char'; span.textContent=ch; span.style.transition = all .6s var(--easing-emphasized) ${(i*30)%300/1000}s; h.appendChild(span); }); requestAnimationFrame(()=>{ h.classList.add('hero-ready'); h.querySelectorAll('.char').forEach(el=>{ el.style.opacity=1; el.style.transform='none'; }); }); }

async function init(){ await openDB(); state.customers = await dbGetAll('customers'); state.trash = await dbGetAll('trash'); state.versions = await dbGetAll('versions'); if(state.customers.length===0){ // demo data state.customers = [ {id:uuid(), name:'å®¢æˆ¶A', tags:['VIP']}, {id:uuid(), name:'å®¢æˆ¶B', tags:['ä¸€èˆ¬']}, {id:uuid(), name:'å®¢æˆ¶C', tags:['é‡é»']}, ]; await dbBulkPut('customers', state.customers); } state.preselect = new Set(state.customers.map(c=>c.id)); bind(); renderList(); buildPreviews(); setupReveal(); heroStagger(); }

init(); </script>

</body>
</html>