[您是一位兼具深厚會計系統架構經驗與前沿前端工程能力的專家。您的任務是構建一個純靜態、離線、所見即得的帳務分析沙盒，其核心理念是將隱性的會計判斷邏輯轉化為顯性、可覆驗、可回放的固定規則。]

R (核心任務)：
[開發一個單一HTML檔案的分析系統，其唯一數據源是解析Excel後生成的標準化交易陣列 tx[]。系統必須實現以下十大分析維度，所有功能均直接操作 tx[]，嚴禁創建數據副本：

1. 摘要檢視與合計：基於（科目代碼 + summary_base）進行唯一性分組，支持期間合併與拆分，實現群內交易拖拽與即時重算，並支持鎖定。
2. 應收付沖帳：實現單科目內的自動一對一沖銷與手動平衡沖銷，並提供獨立的、嚴格區分借貸側別的數字池搜索功能。
3. 關鍵字搜尋：全文命中檢索，結果按科目歸納，支持標亮與直接將命中交易送入其他流程。
4. 獨立數字池分析：在指定科目與借貸側別中，精確搜索加總等於目標金額的交易組合。
5. 異常交易偵測：識別「重複系列」與基於中位數和MAD的「偏離行為」。
6. 跨科目摘要鏈結：以 summary_base 為鍵，可視化展示同一摘要在不同科目間的資金流向與淨額停駐點。
7. 金額結構完整性檢查：從數字形狀（固定倍數、尾數、位數突變、單側累積）角度檢測摘要群的潛在異常。
8. 時間斷層偵測：建立特定摘要的時間節奏模型，檢測缺月、跳月及金額缺失。
9. 規則學習與推測：記錄用戶手動調整的摘要與沖銷規則，並於新資料載入時提供預分建議。
10. 帳務閉合檢查：在期間層級，評估各摘要群的餘額狀態是否合乎業務邏輯上的閉合預期。]

I (關鍵資訊)：

· 可用資源與技術棧：
  · Excel 解析：使用 SheetJS (xlsx) 庫於瀏覽器中讀取上傳的Excel文件。
  · 核心數據結構：交易物件 tx 必須嚴格包含：subjectCode, subjectName, subjectNature(借/貸), date, voucherNo, originalSummary, summaryBase, periodKey, debit, credit。
  · UI 框架：純原生JavaScript (ES6+) 配合DOM操作。可選用<template>標籤或極輕量虛擬DOM方案（如petite-vue）以簡化UI更新，但必須確保最終打包為單一HTML。
· 限制條件：
  · 離線與封裝：必須是單一、完全自包含的index.html文件，透過file://協議直接開啟即可運行。所有CSS必須內聯，JS庫（如xlsx）必須通過CDN引入或內聯，確保離線可用。
  · 數據不可變性：原始tx[]為只讀基底。所有分析功能產生的分組、標記、沖銷狀態，均作為額外的元數據陣列或索引映射存在，不允許深拷貝或修改原始tx物件。
  · 計算精度：所有金額計算必須轉換為整數「分」為單位進行，避免浮點誤差。
· 目標受眾：
  [資深會計師、審計人員或財務分析師。他們需要一個透明、可自定義規則的「邏輯顯微鏡」來覆核帳務，而非一個自動生成報表的黑盒子。]
· 其他背景：
  [此系統的本質是“分析”而非“記帳”。它不修改原始數據，而是附加多層透視圖。所有邏輯必須具備“可回放”性，即對於任一輸出結果，都能追溯到是應用了哪條規則於哪批數據之上。]

S (輸出規範)：

· 格式：
  [一個完整的index.html文件，包含內聯的<style>標籤與<script>標籤，以及通過<script src>引入的必要庫（需考慮離線緩存）。]
· 結構：
  1. HTML佈局：嚴格遵循上（檔案/狀態）、中（功能導航）、下（條件輸入/結果展示）的三段式結構。結果區應採用標籤頁或可折疊區塊來容納不同功能的輸出。
  2. JS 模組架構：
     · parser.js：封裝Excel解析與tx[]初始化邏輯。
     · core.js：定義tx[]陣列及所有核心純函數（如groupBySummary, autoReconcile, numberPoolSearch等）。
     · stateManager.js：管理所有由用戶操作產生的狀態（如鎖定的分組、沖銷標記、學習的規則）。
     · uiRenderer.js：負責將核心函數的結果渲染為DOM，並綁定用戶交互事件。
     · main.js：初始化模組，串聯流程。
  3. 數據流：parser.js -> tx[] -> stateManager（記錄狀態）-> core.js函數（讀取tx[]和狀態）-> uiRenderer.js。
· 風格：
  [介面風格為極簡的單色系或低對比度色彩，突出數據與結構。視覺元素僅用於表達狀態（如鎖定、沖銷、異常）。程式碼須有清晰的中文註解，特別是在關鍵的演算法與規則定義處。]


這是一個離線、單一 HTML、file:// 直接開啟的分類帳分析系統。它的工作只有一個：把報表型分類帳拆成可推理的交易資料，然後用固定、可回放的規則，把人腦在做的帳務判斷全部攤開。

資料進來時，JS 先把 Excel 拆乾淨。公司名、頁次、抬頭、裝飾列全部丟掉。每一筆真正的交易被轉成一列標準結構：科目代碼、科目名稱、該科目的借貸性質、日期、傳票號碼、原始摘要、去期間摘要、期間鍵值、借方金額、貸方金額。月計、累計、上期結轉不進交易層。這一步完成後，後面所有分析只吃這個 tx[]，不再回頭碰 Excel。

摘要被拆成兩層。原始摘要完整保留，用來回溯。另一層是 summary_base，只移除年月與期別，其他字一律保留。114年1月郵電費、114年2月郵電費在這一層會變成同一個核心摘要。期間另外存成 period_key，例如 114-01。

畫面只有三個區塊。上方是檔案選擇與解析狀態。中間是功能切換。下方是條件區與結果區。所有模組共用同一份資料，不複製、不同步。

第一個功能是摘要檢視與合計。規則只有一個：一筆交易只能屬於一個摘要群。群的鍵值由科目代碼加 summary_base 組成。是否合併期間由使用者控制。合併時，114-01 到 114-12 的同摘要會進同一群。顯示時自動壓成 114年1~12月，若月份不連續，顯示實際出現的月份集合。群內實際出現過的原始摘要會列成說明清單。群加總永遠等於群內所有交易加總。任何一筆被移動，兩邊即時重算。群可以鎖定，鎖定後重新解析不會被自動邏輯動到。

第二個功能是應收付沖帳。自動沖銷只在單一科目內運作，只做一件事：在同一摘要群內找金額相等、方向相反的一對一。成立就標記配對。找不到的全部進未沖銷池。手動沖銷只允許一件事：你選的借方總和必須等於你選的貸方總和，成立才寫入。不限筆數，但永遠平衡。沖完後剩下的未沖銷，再用摘要群方式輸出，讓你看卡在哪。

數字池嵌在沖帳流程中，但規則被鎖死。候選集合預設只來自該科目的借貸性質。如果科目是借方性質，數字池只吃借方金額。你可以切換到另一側，但永遠只跑單側，禁止混用。所有金額先轉成整數分再計算。搜尋回傳的每一組都是可驗算的傳票集合，可直接送進手動沖銷勾選。

第三個功能是關鍵字搜尋。只做全文命中，不做推理。輸入關鍵字，回傳所有命中的交易，按科目收納，展開才看到傳票。命中文字直接標亮。任何一筆都能直接送進摘要群或沖銷流程。

第四個功能是獨立數字池分析。選科目，選側別，輸入目標金額。系統只在該科目、該側別內找加總組合。這個功能不碰沖銷狀態，只做數學，結果永遠精準。

第五個功能是異常交易。第一種是重複系列。同摘要、同金額、同科目，只要出現兩次以上就列出整個系列。第二種是偏離行為。對同一摘要群，計算中位數與 MAD，偏離門檻的直接標記為拉高或拉低，回傳對應傳票，不加評語。

第六個功能是跨科目摘要鏈結。系統用 summary_base 當鍵，掃描所有科目，建立流向。這個摘要在哪些科目出現，借了多少，貸了多少，最後淨額停在哪裡，一條線畫清楚。錯科目、漏轉、分流全部直接露出。

第七個功能是金額結構完整性檢查。系統不看摘要文字，只看金額形狀。它檢查三件事：同一摘要群是否長期出現固定倍數或固定尾數；是否在特定期間突然改變位數；是否出現只在某一側累積、不再回沖的結構。這個功能用來抓「帳還在動，但結構已經變質」的情況，尤其適合長期費用與往來帳。

第八個功能是時間斷層偵測（可指定條件）。使用者可以指定摘要，指定是否檢查金額缺口。系統先建立該摘要的正常時間節奏，再檢查是否出現缺月、跳月、或月份存在但金額為零。若啟用金額檢查，系統會判斷是否存在「月份有記錄但金額未出現」或「歷史上應該有金額卻缺失」的情況。結果只回傳缺口點與對應傳票範圍。

第九個功能是規則學習。所有你手動做過的摘要調整與沖銷結果都被記錄。下次匯入新檔，系統先照這些歷史規則預分，標記為推測狀態，你只要確認或否決。系統不自動替你下判斷。

第十個功能是帳務閉合檢查。它不看單筆，而看整體。系統檢查每一個摘要群在期間結尾是否有合理的收斂狀態。該歸零的是否歸零，該留餘的是否被異常沖掉，該累積的是否被拆散到多科目。這個功能不是找錯帳，是找「故事沒講完的帳」。

整個系統的 JS 架構固定且簡單。一個解析器負責把 Excel 轉成 tx[]。一組純函式負責摘要分組、期間整合、沖銷、數字池與異常判斷。所有功能只是不同角度讀同一份資料。沒有副本，沒有同步問題。

這不是報表工具。這是一個把分類帳變成可被反覆驗證、可被質疑、可被回放的分析系統。你現在靠經驗在抓的東西，都被固定成可重現的規則。