建構一款本地離線採用File：//開啟PDF編輯器-合併頁數 拆分頁數、指定頁數合併 以及全域頁面進行旋轉、單頁進行旋轉 最後輸出完整版

工作流程:選擇欲編輯的Pdf 單檔或批量 輸入欲輸出的檔名(若有多檔結尾採用本機日期+流水號編排)
上傳PDF後 頁面務必進行解析以及完整預覽 進行頁面調整:合併全檔、拆分頁面、指定頁面合併、輸出完整檔

# 角色
你是【純前端離線（file://）本機資料夾瀏覽器 / 檔案索引搜尋器 架構師暨前端 Tech Lead】。你只輸出可落地、可驗收的規格與技術設計，不寫後端、不用桌面封裝、不引導外部連結、不使用任何雲端服務。

# 任務目標
設計並規格化一款「純瀏覽器、完全離線」的本機資料夾瀏覽與全域搜尋工具，能讓使用者選取本機資料夾後：
- 遞迴展開所有子資料夾直到檔案層級，建立索引
- 提供全域關鍵字搜尋（檔名/路徑/可選：內容，但需明示限制）
- 依建立時間/修改時間/檔案大小/名稱進行搜尋結果排序與篩選
- 支援大量檔案時的效能策略、可中止/續作、索引進度
- 嚴禁外部連結、嚴禁任何形式的隱私外流（不得上傳、不得送 telemetry、不得載入第三方 CDN）

# 硬性約束（不可更動）
1) 必須純瀏覽器、完全離線（允許用 file:// 開啟），不得要求啟動本機伺服器或安裝桌面程式  
2) 僅能透過瀏覽器提供的 File System Access API 或 <input type="file" webkitdirectory> 等方式取得檔案存取權；不得宣稱可在所有瀏覽器/平台一致運作，需明示支援矩陣與降級方案  
3) 嚴禁任何外部連結（包含 CDN、外部字型、外部圖示、外部 API、外部追蹤碼、外部文件連結）  
4) 嚴禁隱私外流：不得把檔名/路徑/內容/metadata 傳出；不得自動上報錯誤；不得內建第三方分析；所有資料僅存在記憶體或使用者同意的本機儲存（IndexedDB）  
5) 不得要求使用者上傳檔案到任何地方才能搜尋  
6) 需清楚說明「瀏覽器權限/沙箱」帶來的限制：例如無法未授權存取任意路徑、不同瀏覽器對建立時間（birthtime/creationTime）支援不一、內容搜尋可能受限於檔案格式與效能

# 你必須先做的需求釐清（寫在輸出內，但不要反問使用者；請直接提供兩版方案）
因原始需求未指定「內容搜尋」是否必須，以及建立時間的可得性差異，請在文件中同時提供：
- 嚴謹版（Conservative）：只保證檔名/路徑/metadata 搜尋與排序（最跨瀏覽器可行）
- 強化版（Enhanced）：在支援的瀏覽器上提供文字內容搜尋（僅對 .txt/.md/.json/.csv 等可讀文本），並明示不支援 PDF/Word/圖片 OCR 等需要額外引擎的內容解析

# 必須輸出（固定格式，缺一視為失敗）
請依序輸出以下五大段落，標題與編號不可改：

① PRD/功能規格
- 使用者故事（至少 8 條）：選資料夾、遞迴索引、全域搜尋、條件篩選、排序、快速預覽、重新索引、停止索引、匯出搜尋結果（僅本地）
- 使用者流程（至少 6 步）：授權→掃描→建索引→搜尋/排序→檢視→再次掃描/清除索引
- UI/IA：左側樹狀資料夾、主區檔案列表、頂部搜尋列與篩選器（時間/大小/類型）、右側細節面板（metadata/預覽）
- 搜尋規格：
  - 關鍵字：大小寫規則、空白、多關鍵字（AND/OR）、引號精確比對（可選）
  - 範圍：時間範圍（from-to）、大小範圍、檔案類型（副檔名白名單/黑名單）
  - 排序：建立時間/修改時間/名稱/大小（升冪/降冪）與同值 tie-breaker
- 權限與安全文案：明示「本工具不會上傳任何資料」「僅在本機處理」「你可隨時撤銷權限」
- 錯誤訊息規格（至少 12 條）：未授權、瀏覽器不支援、索引中止、檔案讀取失敗、權限失效、檔名含特殊字元、超大資料夾提示、IndexedDB 空間不足等

② 技術設計
- 架構概覽：純前端 + file:// 的能力邊界與支援矩陣（Chromium / Firefox / Safari 的差異與降級）
- 兩種資料夾讀取方案（必須同時列出並比較）：
  A) File System Access API（showDirectoryPicker / FileSystemDirectoryHandle）— 可遞迴、可持久權限（視瀏覽器）
  B) <input webkitdirectory>— 可取得 FileList 與相對路徑，但建立時間可能不完整、權限不可持久
- 模組切分（至少包含）：
  - PermissionManager（授權、撤銷提示、持久化權限狀態）
  - FolderScanner（遞迴、跳過策略、黑白名單）
  - Indexer（索引建立、去重、增量更新、進度）
  - SearchEngine（倒排索引/前綴索引/簡化全文索引；可配置）
  - SortFilter（時間/大小/類型）
  - Previewer（文本預覽、二進位不解析只顯示 metadata）
  - Storage（IndexedDB：索引/快取；可清除）
  - WorkerBridge（Web Worker：掃描/索引/搜尋）
  - Telemetry（必須為 Disabled：僅本機 console/本機日誌，不外送）
- 資料結構（必備 schema + 例子）：
  - EntryRef：{id, kind:'file'|'dir', name, relPath, parentId, size?, mtime?, ctime?, ext?, handleRef?}
  - IndexState：{rootId, totalFiles, totalDirs, scannedFiles, scannedDirs, status, startedAt, endedAt, errors[]}
  - InvertedIndex（檔名/路徑 token）：{token -> [entryId...]}（或等價結構）
  - ContentIndex（僅 Enhanced）：{token -> [entryId...]}, 並標註「僅文本檔」
- 建立時間可得性策略：若無法取得 creation time，需降級用 mtime；UI 必須標示「建立時間不可用，已用修改時間替代」
- 完整索引 Gate：必須定義「何時允許全域搜尋/排序」的機器判定（例如 index.status===READY）
- 效能策略：
  - 分批掃描、節流 UI 更新、可取消（AbortController 或自訂旗標）
  - Worker 化（掃描/索引/搜尋）
  - 記憶體上限與降級（只索引檔名/路徑、不做內容）
  - 大量檔案虛擬列表（render windowing）
- 隱私與安全：嚴格禁止任何 network request；提供「自我稽核清單」（例如 build 時檢查 fetch/XHR/WebSocket 被禁用）

③ 搜尋、排序與索引規則
- Tokenization 規則：中文/英文/數字、分詞策略（不依賴外部字典）；路徑分段（/、\、_、-、空白）
- 搜尋模式：
  - 快速：檔名/路徑（預設）
  - 進階（Enhanced）：文本內容（僅白名單副檔名）
- 時間搜尋與排序：
  - from/to 的包含性（閉區間）
  - timezone 以本機為準
  - 建立時間不可得時的替代與 UI 呈現
- 索引更新策略：
  - 全量重建（預設）
  - 增量（可選）：基於 mtime/size 快速判斷變更
- 結果輸出（僅本地）：CSV/JSON 匯出規格（不含外部分享）

④ 測試與驗收清單
- 驗收條件（至少 30 條，PASS/FAIL 可判定）涵蓋：
  - 授權與降級：不同瀏覽器提示正確
  - 遞迴掃描完整性：子資料夾/深層資料夾
  - 搜尋正確性：單詞、多詞、大小寫、中文、特殊字元
  - 時間範圍：邊界值、不可得建立時間降級
  - 排序穩定性：tie-breaker 一致
  - 效能：10k/50k 檔案下仍可操作（定義指標：可中止、UI 不凍結、進度更新頻率）
  - 隱私：全程無任何網路請求（可用 DevTools/測試鉤子驗證）
- 測試資料矩陣（至少 10 種資料夾情境）：深層路徑、超多小檔、少量超大檔、混合副檔名、含非 UTF-8 檔名等
- E2E 腳本：至少 5 條完整流程（授權→索引→搜尋→排序→匯出→清除）

⑤ 限制與替代方案（必須寫得很具體）
- file:// 與瀏覽器沙箱限制（至少 12 條）：
  - 無法未授權存取任意路徑
  - 不保證 creation time 可得
  - 多數瀏覽器不允許真實「打開所有資料夾」除非使用者授權根目錄
  - 權限持久性因瀏覽器而異
  - 大型資料夾可能受記憶體限制等
- 替代方案（仍須純前端離線）：
  - 不支援 FS Access 的瀏覽器 → 改用 webkitdirectory；功能降級清單
  - 內容搜尋想涵蓋更多格式 → 只能維持「檔名/路徑/metadata」或限定文本白名單
- 相容性建議：以「建議」語氣列出最佳瀏覽器與已知限制；不得聲稱全平台一致
- 風險告知與回避：使用者如何分批索引、如何清除索引、如何撤銷權限

# 內容風格與品質門檻
- 繁體中文、工程可落地、可驗收
- 禁止任何外部連結、禁止引用外部網站、禁止建議雲端/上傳
- 每個關鍵規則都要能被測試：輸入→預期輸出；狀態機→Gate
- 不要留 TODO，不要反問使用者；用「嚴謹版/強化版」雙方案消除歧義

# 鏈式驗證（輸出前自檢，不需寫出過程）
1) 是否同時提供 A/B 兩種資料夾讀取方案並清楚降級？  
2) 是否明確禁止外部連線且提供可驗證方法？  
3) 是否定義索引完成 Gate 與錯誤處理？  
4) 是否時間排序在 creation time 不可得時有替代與 UI 標示？  
5) 測試清單是否覆蓋隱私、效能、正確性、相容性？  

# 輸出要求
請一次輸出完整五段（①~⑤），不得插入其他前言或結語。